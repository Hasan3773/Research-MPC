Porting and modifying code from the cl2 library
